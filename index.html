<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Preview Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for a cleaner look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        .email-body p {
            margin-bottom: 1em;
        }
        .email-body a {
            color: #2563eb; /* blue-600 */
            text-decoration: underline;
        }
        .control-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .bold-btn {
            background-color: #f1f5f9; /* slate-100 */
            border: 1px solid #cbd5e1; /* slate-300 */
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.25rem 0.5rem;
            font-weight: 700;
            color: #475569; /* slate-600 */
            cursor: pointer;
            transition: all 0.2s;
        }
        .bold-btn:hover {
            background-color: #e2e8f0; /* slate-200 */
            border-color: #94a3b8; /* slate-400 */
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <div class="flex flex-col lg:flex-row min-h-screen">
        <!-- CONTROLS PANEL -->
        <div class="w-full lg:w-1/3 bg-white p-6 lg:p-8 shadow-lg lg:h-screen lg:overflow-y-auto">
            <div class="max-w-md mx-auto">
                <h1 class="text-2xl font-bold text-slate-900 mb-2">Email Preview Generator</h1>
                <p class="text-slate-600 mb-8">Select a template and fill in the variables to see a live preview.</p>

                <!-- Email Type -->
                <div class="mb-6">
                    <label for="emailType" class="block text-sm font-medium text-slate-700 mb-2">Email Type</label>
                    <select id="emailType" class="w-full px-3 py-2 bg-slate-50 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                        <!-- Options will be dynamically populated here -->
                    </select>
                </div>

                <!-- Subject Line -->
                <div id="subject-container" class="mb-6">
                    <label for="subjectLine" class="block text-sm font-medium text-slate-700 mb-2">Subject Line</label>
                    <input type="text" id="subjectLine" placeholder="e.g., Project Discussion: Cloud Infrastructure" class="w-full px-3 py-2 bg-slate-50 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                </div>

                <!-- Research Goal -->
                <div class="mb-6">
                    <div class="control-label">
                        <label for="researchGoal" class="block text-sm font-medium text-slate-700">Expert Outreach Research Goal</label>
                        <button id="bold-goal-btn" class="bold-btn" title="Bold (Cmd/Ctrl + B)">B</button>
                    </div>
                    <textarea id="researchGoal" rows="5" placeholder="Describe the research goal here..." class="w-full px-3 py-2 bg-slate-50 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"></textarea>
                </div>

                <!-- Outro -->
                <div class="mb-6">
                     <div class="control-label">
                        <label for="outro" class="block text-sm font-medium text-slate-700">Outro (Optional)</label>
                        <button id="bold-outro-btn" class="bold-btn" title="Bold (Cmd/Ctrl + B)">B</button>
                    </div>
                    <textarea id="outro" rows="3" placeholder="e.g., Looking forward to hearing from you." class="w-full px-3 py-2 bg-slate-50 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"></textarea>
                </div>
            </div>
        </div>

        <!-- PREVIEW PANEL -->
        <div class="w-full lg:w-2/3 flex-1 flex flex-col items-center justify-center p-6 lg:p-8 bg-slate-100">
            <!-- View Toggler -->
            <div class="mb-4 flex items-center bg-slate-200 rounded-full p-1">
                <button id="desktop-btn" class="px-4 py-1.5 text-sm font-semibold rounded-full bg-white text-blue-600 shadow-sm">Desktop</button>
                <button id="mobile-btn" class="px-4 py-1.5 text-sm font-semibold rounded-full text-slate-600">Mobile</button>
            </div>

            <!-- Email Preview Container -->
            <div id="preview-container" class="w-full max-w-3xl bg-white rounded-xl shadow-lg overflow-hidden transition-all duration-300 ease-in-out">
                <!-- Email Client Header -->
                <div class="p-4 bg-slate-50 border-b border-slate-200 flex items-center space-x-2">
                    <div class="w-3 h-3 bg-red-400 rounded-full"></div>
                    <div class="w-3 h-3 bg-yellow-400 rounded-full"></div>
                    <div class="w-3 h-3 bg-green-400 rounded-full"></div>
                </div>

                <!-- Email Content -->
                <div class="p-6 md:p-8">
                    <!-- Subject -->
                    <h2 id="preview-subject" class="text-2xl font-bold text-slate-900 mb-4 pb-4 border-b border-slate-200"></h2>
                      
                    <!-- From/To -->
                    <div class="flex items-center mb-6">
                        <div class="w-10 h-10 bg-blue-600 text-white flex items-center justify-center rounded-full font-bold text-lg mr-4">
                            B
                        </div>
                        <div>
                            <p class="font-semibold text-slate-800">Ben Scheidelman</p>
                            <p class="text-sm text-slate-500">To: Ben</p>
                        </div>
                    </div>

                    <!-- Email Body -->
                    <div id="preview-body" class="text-slate-700 leading-relaxed email-body">
                        <!-- Content will be injected here by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const emailTypeSelect = document.getElementById('emailType');
        const subjectContainer = document.getElementById('subject-container');
        const subjectLineInput = document.getElementById('subjectLine');
        const researchGoalInput = document.getElementById('researchGoal');
        const outroInput = document.getElementById('outro');

        const previewSubject = document.getElementById('preview-subject');
        const previewBody = document.getElementById('preview-body');
        const previewContainer = document.getElementById('preview-container');
          
        const desktopBtn = document.getElementById('desktop-btn');
        const mobileBtn = document.getElementById('mobile-btn');
        
        const boldGoalBtn = document.getElementById('bold-goal-btn');
        const boldOutroBtn = document.getElementById('bold-outro-btn');

        // --- State ---
        let emailCopies = {}; // This object will store our templates from copy.json
        
        // --- Functions ---

        function populateDropdown(data) {
            emailTypeSelect.innerHTML = ''; // Clear any existing options
            for (const key in data) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = data[key].copy_name; // Use the new 'copy_name' field
                emailTypeSelect.appendChild(option);
            }
        }

        /**
         * Toggles <b> tags around the selected text in a textarea.
         * If no text is selected, it toggles the entire content.
         * If the selection is already bold, it removes the tags.
         * @param {HTMLTextAreaElement} textarea The textarea element to modify.
         */
        function toggleBold(textarea) {
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const fullText = textarea.value;

            // Case 1: No text is selected, toggle the whole content
            if (start === end) {
                const isAlreadyBold = fullText.startsWith('<b>') && fullText.endsWith('</b>');
                if (isAlreadyBold) {
                    textarea.value = fullText.substring(3, fullText.length - 4);
                } else {
                    textarea.value = `<b>${fullText}</b>`;
                }
            } 
            // Case 2: Text is selected
            else {
                const selectedText = fullText.substring(start, end);
                const beforeText = fullText.substring(0, start);
                const afterText = fullText.substring(end);

                // Check if the exact selection is already wrapped in <b> tags
                const isAlreadyBold = beforeText.endsWith('<b>') && afterText.startsWith('</b>');

                if (isAlreadyBold) {
                    // Remove the tags from around the selection
                    const newBeforeText = beforeText.substring(0, beforeText.length - 3);
                    const newAfterText = afterText.substring(4);
                    textarea.value = newBeforeText + selectedText + newAfterText;
                    // Adjust selection to be just the text
                    textarea.setSelectionRange(newBeforeText.length, newBeforeText.length + selectedText.length);
                } else {
                    // Add tags around the selection
                    const newText = beforeText + `<b>${selectedText}</b>` + afterText;
                    textarea.value = newText;
                    // Adjust selection to include the tags
                     textarea.setSelectionRange(beforeText.length, beforeText.length + selectedText.length + 7);
                }
            }
            updatePreview(); // Update the live preview
        }

        function updatePreview() {
            const type = emailTypeSelect.value;
            const subject = subjectLineInput.value;
            // The goal and outro text now might contain HTML, so we just replace newlines
            const goal = researchGoalInput.value.replace(/\n/g, '<br>'); 
            const outro = outroInput.value.replace(/\n/g, '<br>');

            subjectContainer.style.display = 'block';
            previewSubject.textContent = subject || '[Subject line]';

            const template = emailCopies[type]?.body;

            if (template) {
                let processedBody = template.replace('{{goal}}', goal || '[Expert Outreach Research Goal]');
                // The outro can now contain HTML, so we don't wrap it in <p> tags here
                const outroHtml = outro ? outro : '';
                processedBody = processedBody.replace('{{outro}}', outroHtml);
                previewBody.innerHTML = processedBody;
            }
        }

        // --- Event Listeners ---
        desktopBtn.addEventListener('click', () => {
            previewContainer.classList.remove('max-w-sm');
            previewContainer.classList.add('max-w-3xl');
            desktopBtn.classList.add('bg-white', 'text-blue-600', 'shadow-sm');
            desktopBtn.classList.remove('text-slate-600');
            mobileBtn.classList.remove('bg-white', 'text-blue-600', 'shadow-sm');
            mobileBtn.classList.add('text-slate-600');
        });

        mobileBtn.addEventListener('click', () => {
            previewContainer.classList.remove('max-w-3xl');
            previewContainer.classList.add('max-w-sm');
            mobileBtn.classList.add('bg-white', 'text-blue-600', 'shadow-sm');
            mobileBtn.classList.remove('text-slate-600');
            desktopBtn.classList.remove('bg-white', 'text-blue-600', 'shadow-sm');
            desktopBtn.classList.add('text-slate-600');
        });

        // Bold button listeners
        boldGoalBtn.addEventListener('click', () => toggleBold(researchGoalInput));
        boldOutroBtn.addEventListener('click', () => toggleBold(outroInput));

        // Keyboard shortcut listener for both textareas
        [researchGoalInput, outroInput].forEach(textarea => {
            textarea.addEventListener('keydown', (event) => {
                if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'b') {
                    event.preventDefault(); // Prevent default browser action (e.g., bookmarks)
                    toggleBold(textarea);
                }
            });
        });


        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            fetch('copy.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    emailCopies = data;
                    
                    populateDropdown(data); // Dynamically create the dropdown options

                    // Attach event listeners for the inputs
                    emailTypeSelect.addEventListener('change', updatePreview);
                    subjectLineInput.addEventListener('input', updatePreview);
                    researchGoalInput.addEventListener('input', updatePreview);
                    outroInput.addEventListener('input', updatePreview);

                    // Set default text for initial load
                    subjectLineInput.value = "Tegus by AlphaSense Research Call";
                    researchGoalInput.value = "I'm reaching out on behalf of a client who is looking to speak with experts with your experience and your perspective would be incredibly valuable.";

                    // Perform the first render with default text
                    updatePreview();
                })
                .catch(error => {
                    console.error("Failed to load or parse copy.json:", error);
                    previewBody.innerHTML = `<p class="text-red-600 font-semibold">Error: Could not load email templates.</p><p class="text-slate-500">Please ensure 'copy.json' is available and correctly formatted.</p>`;
                });
        });

    </script>
</body>
</html>

